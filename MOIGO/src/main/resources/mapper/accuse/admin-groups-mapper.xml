<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<mapper namespace="groupDetail">
	<resultMap id="groupDetailResultMap" type="groupDetail">
		<id property="groupNo" column="GROUP_NO" />
		<result property="groupName" column="GROUP_NAME" />
		<result property="groupMsg" column="GROUP_MSG" />
		<result property="groupPicture" column="GROUP_PICTURE" />
		<result property="groupAddress" column="GROUP_ADDRESS" />		
		<result property="groupGradeCode" column="GROUP_GRADE_CODE" />
		<result property="groupStateCode" column="GROUP_STATE_CODE" />
		<result property="maxMember" column="MAX_MEMBER" />
		<result property="enrollDate" column="ENROLL_DATE" />
		<result property="interestBigCode" column="INTEREST_BIG_CODE" />
		<result property="allowSignup" column="ALLOW_SIGNUP" />
		<result property="minAge" column="MIN_AGE" />
		<result property="maxAge" column="MAX_AGE" />
		<result property="groupGender" column="GROUP_GENDER" />
		<result property="openSetting" column="OPEN_SETTING" />
		<result property="openSetting" column="OPEN_SETTING" />
		<result property="memNum" column="MEM_NUM" />	
		<result property="masterEmail" column="MASTER_EMAIL" />	
		<result property="groupGradeName" column="GROUP_GRADE_NAME" />	
		<result property="gGradeCount" column="GRADE_COUNT" />			
		<result property="bigInterest" column="INTEREST_BIG_NAME" />	
		<result property="ginterestCount" column="GINTEREST" />	
	</resultMap>
	<!-- <select id="selectAccuseList" resultMap="accuseResultMap"> SELECT * 
		FROM ACCUSE ORDER BY ACCUSE_NO DESC </select> -->


	<select id="grpDetail" resultMap="groupDetailResultMap">
		SELECT GROUP_NO,GROUP_NAME,GROUP_MSG,GROUP_PICTURE,GROUP_ADDRESS,GROUP_GRADE_CODE,GROUP_STATE_CODE,MAX_MEMBER,ENROLL_DATE,INTEREST_BIG_CODE,ALLOW_SIGNUP,MIN_AGE,MAX_AGE,GROUP_GENDER,OPEN_SETTING,
		(SELECT COUNT(*) FROM GROUP_MEMBER WHERE GROUP_NO = G.GROUP_NO) MEM_NUM ,
 		(SELECT MEMBER_EMAIL 
		FROM MEMBER M
		JOIN  GROUP_MEMBER  GM
		USING(MEMBER_NO) 
		WHERE GM.MEMBER_GRADE_CODE =3 AND GROUP_NO=#{id}) MASTER_EMAIL
		FROM GROUPS G
		WHERE GROUP_NO=#{id}
	</select>
	<select id="gGradeCount" resultMap="groupDetailResultMap">
		SELECT GROUP_GRADE_NAME, COUNT(*) GRADE_COUNT
		FROM GROUPS
		JOIN GROUP_GRADE USING(GROUP_GRADE_CODE)
		GROUP BY GROUP_GRADE_NAME
		ORDER BY GRADE_COUNT DESC
	</select>
	
	<select id="ginterestCount" resultMap="groupDetailResultMap">
		SELECT INTEREST_BIG_NAME, COUNT(*) GINTEREST
		FROM GROUPS
		JOIN INTEREST_BIG USING(interest_big_code)
		GROUP BY INTEREST_BIG_NAME ORDER BY GINTEREST DESC
	</select>
</mapper>