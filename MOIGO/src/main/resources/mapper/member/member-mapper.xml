<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">
	
	<resultMap type="member" id="memberResultMap">
		<id property="memberNo" column="MEMBER_NO"/>
		<result property="memberEmail" column="MEMBER_EMAIL"/>
		<result property="memberPwd" column="MEMBER_PWD"/>
		<result property="memberName" column="MEMBER_NAME"/>
		<result property="memberAddress" column="MEMBER_ADDRESS"/>
		<result property="memberBirth" column="MEMBER_BIRTH"/>
		<result property="memberGender" column="MEMBER_GENDER"/>
		<result property="enrollDate" column="ENROLL_DATE"/>
	</resultMap>
	

	<select id="selectOneMember" resultMap="memberResultMap" >
		SELECT * FROM MEMBER
		WHERE MEMBER_EMAIL = #{memberEmail} AND DELFLAG='N'
	</select>
	
	<select id="checkIdDuplicate" resultType="_int">
		SELECT COUNT(*) AS CNT FROM MEMBER WHERE MEMBER_EMAIL = #{memberEmail}  
	</select>
	
 	<insert id="insertMember" parameterType="member">
 		<selectKey keyProperty="memberNo" resultType="string" order="AFTER">
			SELECT 'M'||TO_CHAR(SEQ_MEMBER.CURRVAL,'FM000') FROM DUAL
		</selectKey>
		INSERT INTO MEMBER 
		VALUES('M'||TO_CHAR(SEQ_MEMBER.NEXTVAL,'FM000'),#{memberEmail}, #{memberPwd},#{memberName}, #{memberAddress, jdbcType=VARCHAR},
			   (TO_CHAR(#{memberBirth},'RRRR/MM/DD')), #{memberGender}, DEFAULT, 'N')
	</insert>
	
	<insert id="insertMemberInterest" parameterType="hashmap">
			INSERT INTO MEMBER_INTEREST VALUES(#{memberNo},#{interest,jdbcType=VARCHAR})
	</insert>
	
	<update id="updateMemberPwd" parameterType="hashmap">
		UPDATE MEMBER SET MEMBER_PWD = #{memberPwd} WHERE MEMBER_EMAIL=#{memberEmail}
	</update>
	
	<update id="deleteMember" parameterType="string">
		UPDATE MEMBER SET DELFLAG = 'Y' WHERE MEMBER_NO=#{memberNo}
	</update>
	
	<insert id="insertDropout" parameterType="hashmap">
		INSERT INTO DROPOUT VALUES(#{memberNo}, #{contentW}) 
	</insert>
	<select id= "selectInterestList" resultType="string">
		SELECT INTEREST_BIG_CODE
		FROM MEMBER_INTEREST 
		WHERE MEMBER_NO=#{memberNo}
	</select>
	
	<update id="updateMember" parameterType="member">
		UPDATE MEMBER 
		SET MEMBER_NAME=#{memberName},
			MEMBER_ADDRESS=#{memberAddress}, 
			MEMBER_BIRTH=#{memberBirth}
		WHERE MEMBER_NO=#{memberNo}
	</update>  
</mapper>

